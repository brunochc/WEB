<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEDULA ‚Äî Portal Paciente (Desktop + JS, Vistas & Sincronizaci√≥n)</title>
  <link rel="stylesheet" href="../css/historialcard.css" />
</head>
<body class="theme-dark">
  <a href="#historial" class="skip-link">Saltar al contenido</a>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="side-header p-6">
        <div class="flex items-center gap-3 mb-4">
          <a href="../../pages/Paciente/paciente.html"><img src="../../components/recetas/im√°genes/medula_icono.png" alt="MEDULA" width="40" height="40"></a>
          <div>
            <h1 class="brand-title">MEDULA</h1>
            <p class="subtitle">Cuida, Organiza y Protege</p>
          </div>
        </div>
        <div class="user-card flex items-center gap-3" aria-label="Usuario"><a href="#perfil" class="stretched-link" aria-label="Ir al perfil de usuario"></a>
          <div class="user-badge" style="width:44px;height:44px;border-radius:12px;background:rgba(41,165,255,.12);display:flex;align-items:center;justify-content:center;color:#2a6dff;font-weight:800">MG</div>
          <div>
            <p style="margin:0;font-weight:800">Mar√≠a Gonz√°lez</p>
            <p class="subtitle" style="margin:2px 0 0">12.345.678-9</p>
          </div>
        </div>
      </div>

      <nav class="p-6" aria-label="Secciones">
        <a href="#historial" id="link-historial"><span class="nav-icon">üóÇ</span> Historial M√©dico</a>
        <a href="#medicamentos" id="link-medicamentos"><span class="nav-icon">üíä</span> Mis Medicamentos</a>
        <a href="#examenes" id="link-examenes"><span class="nav-icon">üß™</span> Resultados de Ex√°menes</a>
        <a href="#perfil" id="link-perfil"><span class="nav-icon">üë§</span> Mi Perfil</a>
      </nav>

      <div class="p-6" style="margin-top:auto;border-top:1px solid var(--border)">
        <div class="space-y-3">
          <div class="flex gap-3">
            <button class="btn btn-outline" id="btn-font" aria-pressed="false">A+ Tama√±o</button>
            <button class="btn btn-outline" id="btn-dark" aria-pressed="false">Modo Noche</button>
          </div>
          <div class="flex gap-3">
            <button class="btn" id="btn-allow-notif" title="Permitir avisos en este dispositivo">üîî Permitir avisos</button>
            <button class="btn" id="btn-export-all" title="Exportar todos los recordatorios como .ics">üóÇ Exportar todo</button>
          </div>
          <a id="btn-sync-gcal" class="btn" style="width:100%" target="_blank" rel="noopener" href="https://calendar.google.com/calendar/u/0/r/settings/import">üîÑ Sincronizar con Google</a>
          <button class="btn" style="width:100%" id="btn-logout">‚Ü© Cerrar Sesi√≥n</button>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="p-6">
        <!-- HISTORIAL -->
        <section class="section default" id="historial">
          <div class="space-y-7">
            <div class="flex items-center between">
              <h2 class="page-title">Historial M√©dico</h2>
              <button class="btn btn-primary" id="btn-print">‚¨á Descargar PDF</button>
            </div>

            <!-- CONTENIDO DEL TIMELINE M√âDICO INTEGRADO -->
            <div class="timeline-container">
                <div class="timeline-column">
                    <div class="card">
                        <div class="card-header p-5">
                            <h3 class="page-title">Mi Timeline M√©dico</h3>
                        </div>
                        
                        <div class="card-content p-5 space-y-5">
                            <div class="consultation-type">
                                <h4 class="detail-title">Consulta especialista: Cardiologo</h4>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Motivo de la consulta:</h4>
                                <p>El paciente presentaba dolor tor√°cico, dolor de cabeza y fiebre.</p>
                            </div>
                            
                            <div class="detail-section flex items-center gap-3">
                                <h4 class="detail-title">Fecha:</h4>
                                <p class="badge">15 Ago 2024 12:00 pm</p>
                            </div>
                            
                            <div class="detail-section flex items-center gap-3">
                                <h4 class="detail-title">Estado:</h4>
                                <p class="badge ok">Completada</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Centro M√©dico:</h4>
                                <p>Hospital Barros Luco Trudeau</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Nombre especialista:</h4>
                                <p>Dr. Juan P√©rez</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Diagn√≥stico:</h4>
                                <p>El paciente presentaba dolor tor√°cico, dolor de cabeza y fiebre, por lo que se le diagnostic√≥ una infecci√≥n respiratoria aguda.</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Evoluci√≥n:</h4>
                                <p>El paciente evolucion√≥ bien, tuvo un control de 15 d√≠as, donde la fiebre se control√≥ adecuadamente.</p>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Medicamentos:</h4>
                                <div class="med-row">
                                    <div class="pill-icon">
                                        <i>üíä</i>
                                    </div>
                                    <div>
                                        <p><strong>Paracetamol 500mg</strong></p>
                                        <p>Tomar cada 8 horas durante 5 d√≠as</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Receta:</h4>
                                <ul class="medication-list">
                                    <li>Paracetamol 500mg - Tomar cada 8 horas por 5 d√≠as</li>
                                    <li>Ibuprofeno 400mg - Tomar cada 12 horas por 3 d√≠as</li>
                                </ul>
                                <a href="#" class="btn btn-outline view-prescription">Ver receta completa</a>
                            </div>
                            
                            <div class="detail-section">
                                <h4 class="detail-title">Indicaci√≥n de ex√°menes:</h4>
                                <ul class="exam-list">
                                    <li class="doc-icon-container">
                                        <div class="doc-icon">
                                            <i>üìÑ</i>
                                        </div>
                                        <div>
                                            <a href="#">Examen de sangre</a>
                                            <p class="text-2">Resultados disponibles</p>
                                        </div>
                                    </li>
                                    <li class="doc-icon-container">
                                        <div class="doc-icon">
                                            <i>üìÑ</i>
                                        </div>
                                        <div>
                                            <a href="#">Examen de orina</a>
                                            <p class="text-2">Pendiente de realizaci√≥n</p>
                                        </div>
                                    </li>
                                    <li class="doc-icon-container">
                                        <div class="doc-icon">
                                            <i>üìÑ</i>
                                        </div>
                                        <div>
                                            <a href="#">Electrocardiograma</a>
                                            <p class="text-2">Programado para 22 Ago</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- FIN DEL CONTENIDO DEL TIMELINE M√âDICO -->
            
          </div>
        </section>

        <!-- MEDICAMENTOS -->
        <section class="section" id="medicamentos">
          <div class="space-y-7">
            <h2 class="page-title">Mis Medicamentos</h2>

            <div class="space-y-5">
              <div class="card p-5">
                <div class="med-row">
                  <div class="flex items-center gap-4">
                    <div class="pill-icon" aria-hidden="true">üíä</div>
                    <div>
                      <h3 style="margin:0;font-weight:800">Metformina</h3>
                      <p class="subtitle">850 mg ‚Äî 1 cada 12h</p>
                      <p>Pr√≥xima dosis: hoy 20:00</p>
                    </div>
                  </div>
                  <div style="text-align:right">
                    <p style="margin:0 0 6px;font-weight:800">Stock: 8 d√≠as</p>
                    <div class="progress" aria-label="progreso stock"><span style="width:28%"></span></div>
                  </div>
                </div>
              </div>

              <div class="card p-5">
                <div class="med-row">
                  <div class="flex items-center gap-4">
                    <div class="pill-icon" aria-hidden="true">üíä</div>
                    <div>
                      <h3 style="margin:0;font-weight:800">Losart√°n</h3>
                      <p class="subtitle">50 mg ‚Äî 1 diaria</p>
                      <p>Pr√≥xima dosis: ma√±ana 08:00</p>
                    </div>
                  </div>
                  <div style="text-align:right">
                    <p style="margin:0 0 6px;font-weight:800">Stock: 22 d√≠as</p>
                    <div class="progress" aria-label="progreso stock"><span style="width:73%"></span></div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </section>

        <!-- EX√ÅMENES -->
        <section class="section" id="examenes">
          <div class="space-y-7">
            <h2 class="page-title">Resultados de Ex√°menes</h2>

            <div class="space-y-5">
              <div class="card p-5">
                <div class="flex items-center between">
                  <div class="flex items-center gap-4">
                    <div class="doc-icon" aria-hidden="true">üìÑ</div>
                    <div>
                      <h3 style="margin:0;font-weight:800">Perfil Lip√≠dico</h3>
                      <p class="subtitle">15 Dic 2023</p>
                      <span class="badge ok">‚úÖ Normal</span>
                    </div>
                  </div>
                  <button class="btn btn-ghost view-btn" data-title="Perfil Lip√≠dico" data-detail="15 Dic 2023 ‚Äî Resultado: Normal">üëÅ Ver</button>
                </div>
              </div>

              <div class="card p-5">
                <div class="flex items-center between">
                  <div class="flex items-center gap-4">
                    <div class="doc-icon" aria-hidden="true">üìÑ</div>
                    <div>
                      <h3 style="margin:0;margin:0;font-weight:800">Hemograma Completo</h3>
                      <p class="subtitle">28 Nov 2023</p>
                      <span class="badge ok">‚úÖ Normal</span>
                    </div>
                  </div>
                  <button class="btn btn-ghost view-btn" data-title="Hemograma Completo" data-detail="28 Nov 2023 ‚Äî Resultado: Normal">üëÅ Ver</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- PERFIL -->
        <section class="section" id="perfil">
          <div class="space-y-7">
            <h2 class="page-title">Mi Perfil</h2>

            <div class="card">
              <div class="p-5">
                <h3 style="margin:0 0 10px;font-weight:800">Informaci√≥n Personal</h3>
                <div class="space-y-5">
                  <div class="grid-2">
                    <div>
                      <div class="label">Nombre Completo</div>
                      <p style="margin:0;font-weight:800">Mar√≠a Esperanza Gonz√°lez P√©rez</p>
                    </div>
                    <div>
                      <div class="label">RUT</div>
                      <p style="margin:0;font-weight:800">12.345.678-9</p>
                    </div>
                    <div>
                      <div class="label">Fecha de Nacimiento</div>
                      <p style="margin:0;font-weight:800">15 de Marzo, 1985</p>
                    </div>
                    <div>
                      <div class="label">Edad</div>
                      <p style="margin:0;font-weight:800">38 a√±os</p>
                    </div>
                  </div>

                  <div class="separator"></div>

                  <div class="grid-2">
                    <div>
                      <div class="label">Plan FONASA</div>
                      <p style="margin:0;font-weight:800">Tramo B</p>
                    </div>
                    <div>
                      <div class="label">Centro de Salud</div>
                      <p style="margin:0;font-weight:800">CESFAM La Florida</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- PANEL DERECHO: Calendario + Form + Pr√≥ximas Citas -->
    <aside class="right p-6 space-y-8">
      <!-- Formulario nuevo recordatorio -->
      <div class="card" aria-labelledby="formTitle">
        <div class="p-5 space-y-4">
          <div class="form-head"><h3 id="formTitle">‚ûï Nuevo recordatorio</h3></div>
            <form id="reminderForm" class="grid-2" autocomplete="off">
            <div class="field">
              <label for="title" class="label">T√≠tulo *</label>
              <input id="title" name="title" type="text" required placeholder="Ej: Consulta cardiolog√≠a" />
            </div>
            <div class="field">
              <label for="type" class="label">Tipo *</label>
              <select id="type" name="type" required>
                <option value="consulta">Consulta</option>
                <option value="examen">Examen</option>
                <option value="medicamento">Medicamento</option>
              </select>
            </div>
            <div class="field">
              <label for="date" class="label">Fecha *</label>
              <input id="date" name="date" type="date" required />
            </div>
            <div class="field">
              <label for="time" class="label">Hora</label>
              <input id="time" name="time" type="time" />
            </div>
            <div class="field">
              <label for="location" class="label">Lugar</label>
              <input id="location" name="location" type="text" placeholder="Cl√≠nica, direcci√≥n o virtual" />
            </div>
            <div class="field">
              <label for="notes" class="label">Notas</label>
              <textarea id="notes" name="notes" placeholder="Indicaciones, preparaci√≥n, etc."></textarea>
            </div>
            <div class="field" style="grid-column:1/-1;display:flex;gap:12px;flex-wrap:wrap">
              <button type="submit" class="btn btn-primary">üíæ A√±adir al calendario</button>
              <button type="button" id="exportICSBtn" class="btn">üì• Guardar y exportar .ics</button>
              <span id="formStatus" class="subtitle" aria-live="polite"></span>
            </div>
          </form>
        </div>
      </div>

      <!-- Calendario mensual (est√°tico por ahora) -->
      <div class="calendar" aria-label="Calendario">
        <div class="cal-head">
          <div class="cal-actions">
            <button class="btn" id="prevMonth" aria-label="Mes anterior">‚óÄ</button>
            <button class="btn" id="todayBtn" aria-label="Ir a hoy">Hoy</button>
            <button class="btn" id="nextMonth" aria-label="Mes siguiente">‚ñ∂</button>
          </div>
          <div class="cal-title"><span id="monthName">Septiembre</span> <span id="yearNum">2025</span></div>
          <div class="cal-toolbar">
            <div class="segmented" role="group" aria-label="Cambiar vista">
              <button id="viewMonth" aria-pressed="true">Mes</button>
              <button id="viewWeek" aria-pressed="false">Semana</button>
              <button id="viewList" aria-pressed="false">Lista</button>
            </div>
          </div>
          <div class="cal-search" role="search">
            <span class="icon">üîé</span>
            <input id="searchBox" type="text" placeholder="Buscar eventos..." aria-label="Buscar eventos" />
          </div>
        </div>
        <div class="cal-legend" aria-hidden="true">
          <span><span class="cal-dot consulta"></span>Consulta</span>
          <span><span class="cal-dot examen"></span>Examen</span>
          <span><span class="cal-dot medicamento"></span>Medicamento</span>
        </div>
        <div id="monthView">
          <div class="cal-grid" id="calGrid">
            <div class="cal-dow">Lun</div>
            <div class="cal-dow">Mar</div>
            <div class="cal-dow">Mi√©</div>
            <div class="cal-dow">Jue</div>
            <div class="cal-dow">Vie</div>
            <div class="cal-dow">S√°b</div>
            <div class="cal-dow">Dom</div>
            <div class="cal-cell"><div class="cal-day">1</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">2</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">3</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">4</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">5</div><div class="events"><a href="#" class="cal-event" data-type="medicamento">09:00 ‚Äî Vacuna Influenza</a></div><div class="count">1</div></div>
            <div class="cal-cell"><div class="cal-day">6</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">7</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">8</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">9</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">10</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">11</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">12</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">13</div><div class="events"><a href="#" class="cal-event" data-type="consulta">12:30 ‚Äî Control nutrici√≥n</a></div><div class="count">1</div></div>
            <div class="cal-cell"><div class="cal-day">14</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">15</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">16</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">17</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">18</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">19</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">20</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">21</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">22</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">23</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">24</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">25</div><div class="events"><a href="#" class="cal-event" data-type="examen">08:00 ‚Äî Hemograma</a></div><div class="count">1</div></div>
            <div class="cal-cell"><div class="cal-day">26</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">27</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">28</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">29</div><div class="events"></div></div>
            <div class="cal-cell"><div class="cal-day">30</div><div class="events"></div></div>
            <div class="cal-cell" aria-hidden="true"></div>
            <div class="cal-cell" aria-hidden="true"></div>
            <div class="cal-cell" aria-hidden="true"></div>
            <div class="cal-cell" aria-hidden="true"></div>
            <div class="cal-cell" aria-hidden="true"></div>
          </div>
        </div>
        <div id="weekView" hidden>
          <div class="week-grid" id="weekGrid">
            <div class="week-col"><h4>Lun</h4></div>
            <div class="week-col"><h4>Mar</h4></div>
            <div class="week-col"><h4>Mi√©</h4></div>
            <div class="week-col"><h4>Jue</h4></div>
            <div class="week-col"><h4>Vie</h4></div>
            <div class="week-col"><h4>S√°b</h4></div>
            <div class="week-col"><h4>Dom</h4></div>
          </div>
        </div>
        <div id="listView" hidden>
          <div id="listWrap" class="space-y-3">
            <div class="list-day"><h4>Septiembre 2025</h4><div class="subtitle">Lista de eventos (vista de ejemplo, sin JS)</div></div>
          </div>
        </div>
      </div>

      <!-- Pr√≥ximas Citas -->
      <div class="card">
        <div class="p-5">
          <div class="flex between items-center">
            <h3>üìÖ Pr√≥ximas Citas</h3>
            <div class="flex gap-2">
              <select id="filterType" aria-label="Filtrar por tipo" class="btn">
                <option value="all">Todas</option>
                <option value="consulta">Consulta</option>
                <option value="examen">Examen</option>
                <option value="medicamento">Medicamento</option>
              </select>
              <button id="clearAll" class="btn" title="Borrar todos">üóë</button>
            </div>
          </div>
          <div id="apptList" class="space-y-3" aria-live="polite"></div>
        </div>
      </div>

      <!-- Alertas -->
      <div class="card">
        <div class="p-5 space-y-3">
          <h3>‚ö† Alertas</h3>
          <div style="background:var(--warning-50);border:1px solid var(--warning-200);color:var(--warning-800);padding:12px;border-radius:12px">
            <div style="font-weight:800">Medicamento por acabar</div>
            <div class="subtitle" style="margin-top:4px;color:var(--warning-800)">Metformina ‚Äî 8 d√≠as restantes</div>
          </div>
          <div style="background:var(--info-50);border:1px solid var(--info-200);color:var(--info-800);padding:12px;border-radius:12px">
            <div style="font-weight:800">Recordatorio</div>
            <div class="subtitle" style="margin-top:4px;color:var(--info-800)">Control cardiol√≥gico pendiente</div>
          </div>
        </div>
      </div>

      <!-- Emergencias -->
      <div class="card">
        <div class="p-5">
          <h3>‚òé Emergencias</h3>
          <div class="space-y-3" style="font-weight:800">
            <div>SAMU: 131</div>
            <div>Bomberos: 132</div>
            <div>Carabineros: 133</div>
            <div class="separator"></div>
            <div style="font-weight:600">‚úâ medula@fonasa.cl</div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- Modal gen√©rico -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="head">
        <strong id="modalTitle">Detalle</strong>
        <button class="btn" id="closeModal" aria-label="Cerrar">‚úñ</button>
      </div>
      <div class="body">
        <pre id="modalBody" style="white-space:pre-wrap;margin:0"></pre>
      </div>
    </div>
  </div>

</body>
</html>